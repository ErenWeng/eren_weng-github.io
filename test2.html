<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <script
      src="https://code.jquery.com/jquery-3.5.0.min.js"
      integrity="sha256-xNzN2a4ltkB44Mc/Jz3pT4iU1cmeR0FkXs4pru/JxaQ="
      crossorigin="anonymous"
    ></script>
  </head>
  <body>
    <!-- Get Permsiion -->
    <button type="button" id="btnGetNotification">取得顯示通知權限</button>

    <script>
      $("#btnGetNotification").click(function () {
        navigator.serviceWorker.register("sw.js"); //???
        if (Notification && Notification.permission === "default") {
          Notification.requestPermission(function (permission) {
            if (!("permission" in Notification)) {
              Notification.permission = permission;
            }
          });
        } else if (Notification.permission === "granted") {
          alert("已經有取得權限了!");
        } else {
          alert("請檢查是否你的瀏覽器支援");
        }
      });
    </script>

    <!-- Display Notification -->
    <button type="button" id="btnShowNotification">跑一個顯示通知範例</button>
    <script>
      navigator.serviceWorker.register("sw.js");
      var notification = null;
      function ShowNotification(title, body) {
        notification = new Notification(title, {
          icon: "/images/404.jpg",
          body: body,
          onclick: function () {
            parent.focus();
            window.focus(); //just in case, older browsers
            this.close();
          },
        });
      }

      $("#btnShowNotification").click(function () {
        if (Notification && Notification.permission === "default") {
          Notification.requestPermission(function (permission) {
            if (!("permission" in Notification)) {
              Notification.permission = permission;
            }
          });
        } else if (Notification.permission === "granted") {
          ShowNotification("Betterme", "該喝水囉");
          //5秒後自動關閉
          setTimeout(notification.close.bind(notification), 5000);
        } else {
          alert("請檢查是否你的瀏覽器支援");
        }
      });
    </script>
  </body>
</html>
