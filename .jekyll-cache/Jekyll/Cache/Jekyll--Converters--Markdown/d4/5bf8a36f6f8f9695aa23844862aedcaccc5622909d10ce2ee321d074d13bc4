I"Ú<p><br /></p>

<h3 id="let-å’Œ-let-çš„å€åˆ¥"><code class="language-plaintext highlighter-rouge">let</code> å’Œ <code class="language-plaintext highlighter-rouge">let!</code> çš„å€åˆ¥</h3>

<p>åœ¨å¯«æ¸¬è©¦æ™‚ï¼Œå¦‚æœé‡åˆ°éœ€è¦é‡è¤‡ä½¿ç”¨çš„åƒæ•¸æ™‚ï¼Œé€™æ™‚æœƒç”¨letæŠŠåƒæ•¸ä¸€æ¬¡å¯«åœ¨æœ€å‰é¢</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">let</code>ï¼šåªåœ¨åƒæ•¸è¢«å‘¼å«æ™‚æ‰æœƒè§¸ç™¼ï¼Œåˆç¨±æƒ°æ€§æ±‚å€¼ï¼ˆLazy Evaluationï¼‰</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> def let(name, &amp;block)
# We have to pass the block directly to `define_method` to
# allow it to use method constructs like `super` and `return`.
raise "#let or #subject called without a block" if block.nil?
raise(
"#let or #subject called with a reserved name #initialize"
) if :initialize == name
our_module = MemoizedHelpers.module_for(self)

# If we have a module clash in our helper module
# then we need to remove it to prevent a warning.
#
# Note we do not check ancestor modules (see: `instance_methods(false)`)
# as we can override them.
if our_module.instance_methods(false).include?(name)
our_module.__send__(:remove_method, name)
end
our_module.__send__(:define_method, name, &amp;block)

# If we have a module clash in the example module
# then we need to remove it to prevent a warning.
#
# Note we do not check ancestor modules (see: `instance_methods(false)`)
# as we can override them.
if instance_methods(false).include?(name)
remove_method(name)
end

# Apply the memoization. The method has been defined in an ancestor
# module so we can use `super` here to get the value.
if block.arity == 1
define_method(name) { __memoized.fetch_or_store(name) { super(RSpec.current_example, &amp;nil) } }
else
define_method(name) { __memoized.fetch_or_store(name) { super(&amp;nil) } }
end
end
</code></pre></div></div>

<ul>
  <li><code class="language-plaintext highlighter-rouge">let!</code>ï¼šåœ¨æ¯å€‹exampleå‰é¢éƒ½æœƒäº‹å…ˆè§¸ç™¼</li>
</ul>

<p>åŸå§‹ç¢¼ï¼š</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>def let!(name, &amp;block)
  let(name, &amp;block)
  before { __send__(name) }
end
</code></pre></div></div>
:ET