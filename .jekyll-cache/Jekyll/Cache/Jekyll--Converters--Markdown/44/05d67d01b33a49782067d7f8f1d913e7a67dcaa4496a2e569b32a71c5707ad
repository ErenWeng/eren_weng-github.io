I"Ü<p><br /></p>

<h3 id="let-å’Œ-let-çš„å€åˆ¥"><code class="language-plaintext highlighter-rouge">let</code> å’Œ <code class="language-plaintext highlighter-rouge">let!</code> çš„å€åˆ¥</h3>

<p>åœ¨å¯«æ¸¬è©¦æ™‚å¦‚æœé‡åˆ°éœ€è¦é‡è¤‡ä½¿ç”¨çš„åƒæ•¸ï¼Œå¯ä»¥ç”¨letæŠŠåƒæ•¸ä¸€æ¬¡å¯«åœ¨æœ€å‰é¢</p>

<blockquote>
  <p>Note that let is lazy-evaluated (æƒ°æ€§æ±‚å€¼) : it is not evaluated until the first time. the method it defines is invoked. You can use let! to force the methodâ€™s invocation before each example.<a href="https://relishapp.com/rspec/rspec-core/v/3-9/docs/helper-methods/let-and-let#use-%60let%60-to-define-memoized-helper-method">Project: RSpec Core 3.9</a></p>
</blockquote>

<p>ä¹Ÿå°±æ˜¯èªªå…©è€…å·®åˆ¥åœ¨æ–¼ï¼š</p>
<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">let</code>ï¼šåœ¨æŸå€‹exampleå…§ï¼Œåƒæ•¸æœ‰è¢«å‘¼å«æ‰æœƒè§¸ç™¼</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">let!</code>ï¼šåœ¨æ¯å€‹exampleå…§éƒ½æœƒäº‹å…ˆè§¸ç™¼</p>
  </li>
</ul>

<p>åŸå§‹ç¢¼ï¼š</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">let</span><span class="p">(</span><span class="nb">name</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">block</span><span class="p">)</span>
  <span class="k">raise</span> <span class="s2">"#let or #subject called without a block"</span> <span class="k">if</span> <span class="n">block</span><span class="p">.</span><span class="nf">nil?</span>
  <span class="k">raise</span><span class="p">(</span>
  <span class="s2">"#let or #subject called with a reserved name #initialize"</span>
  <span class="p">)</span> <span class="k">if</span> <span class="ss">:initialize</span> <span class="o">==</span> <span class="nb">name</span>
  <span class="n">our_module</span> <span class="o">=</span> <span class="no">MemoizedHelpers</span><span class="p">.</span><span class="nf">module_for</span><span class="p">(</span><span class="nb">self</span><span class="p">)</span>

  <span class="k">if</span> <span class="n">our_module</span><span class="p">.</span><span class="nf">instance_methods</span><span class="p">(</span><span class="kp">false</span><span class="p">).</span><span class="nf">include?</span><span class="p">(</span><span class="nb">name</span><span class="p">)</span>
    <span class="n">our_module</span><span class="p">.</span><span class="nf">__send__</span><span class="p">(</span><span class="ss">:remove_method</span><span class="p">,</span> <span class="nb">name</span><span class="p">)</span>
  <span class="k">end</span>
  <span class="n">our_module</span><span class="p">.</span><span class="nf">__send__</span><span class="p">(</span><span class="ss">:define_method</span><span class="p">,</span> <span class="nb">name</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">block</span><span class="p">)</span>

  <span class="k">if</span> <span class="nb">instance_methods</span><span class="p">(</span><span class="kp">false</span><span class="p">).</span><span class="nf">include?</span><span class="p">(</span><span class="nb">name</span><span class="p">)</span>
    <span class="n">remove_method</span><span class="p">(</span><span class="nb">name</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="k">if</span> <span class="n">block</span><span class="p">.</span><span class="nf">arity</span> <span class="o">==</span> <span class="mi">1</span>
    <span class="n">define_method</span><span class="p">(</span><span class="nb">name</span><span class="p">)</span> <span class="p">{</span> <span class="n">__memoized</span><span class="p">.</span><span class="nf">fetch_or_store</span><span class="p">(</span><span class="nb">name</span><span class="p">)</span> <span class="p">{</span> <span class="k">super</span><span class="p">(</span><span class="no">RSpec</span><span class="p">.</span><span class="nf">current_example</span><span class="p">,</span> <span class="o">&amp;</span><span class="kp">nil</span><span class="p">)</span> <span class="p">}</span> <span class="p">}</span>
  <span class="k">else</span>
    <span class="n">define_method</span><span class="p">(</span><span class="nb">name</span><span class="p">)</span> <span class="p">{</span> <span class="n">__memoized</span><span class="p">.</span><span class="nf">fetch_or_store</span><span class="p">(</span><span class="nb">name</span><span class="p">)</span> <span class="p">{</span> <span class="k">super</span><span class="p">(</span><span class="o">&amp;</span><span class="kp">nil</span><span class="p">)</span> <span class="p">}</span> <span class="p">}</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">let!</span><span class="p">(</span><span class="nb">name</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">block</span><span class="p">)</span>
  <span class="n">let</span><span class="p">(</span><span class="nb">name</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">block</span><span class="p">)</span>
  <span class="n">before</span> <span class="p">{</span> <span class="nb">__send__</span><span class="p">(</span><span class="nb">name</span><span class="p">)</span> <span class="p">}</span>
<span class="k">end</span>
</code></pre></div></div>

<p><a href="https://github.com/rspec/rspec-core/blob/master/lib/rspec/core/memoized_helpers.rb">åŸå§‹ç¢¼ä¾†æº</a></p>

<h3 id="beforeeach-å’Œ-beforeallçš„å€åˆ¥"><code class="language-plaintext highlighter-rouge">before(:each)</code> å’Œ <code class="language-plaintext highlighter-rouge">before(:all)</code>çš„å€åˆ¥</h3>

<blockquote>
  <p>before(:example) # run before each exampleï¼Œbefore(:context) # run one time only, before all of the examples in a group</p>
</blockquote>

<p>before(:all) is run when the context/describe block begins,
before(:all) is run outside of transactions, so data created here will bleed into other specs
before(:each) is run before each spec inside it,</p>
:ET